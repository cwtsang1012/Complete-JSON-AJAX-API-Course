<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>JSON</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
</head>

<body>
    <h1>Checklist JSON in javascript</h1>
    <dt>
        <dt>2 Performances:</dt>
    <dd>- adding checkitems</dd>
    <dd>- check/uncheck the box</dd>
    </dt>
    <div id="output">
        <ul id="tasklist"></ul>
    </div>
    <form id="myForm">
        Task: <input type='text' name='task' placeholder="add task">
        <input type="submit" value="Add new task">
    </form>
    
    <script type="text/javascript">
        //use JSON within javascript object
        //One of the difference between JSON and javascript object is that JSON allows space in name part of name/value pair
        var dataJSON = '';
        window.onload = function() {
            if (sessionStorage["tasks"] != null) {
                dataJSON = JSON.parse(sessionStorage["tasks"]);
            } else {
                //default value
                var data = '[{"info": "CutGrass", "status": false}, {"info": "Clean Room","status": false}, {"info": "Go to Gym","status": false},{"info": "Make Dinner","status": false}]';
                dataJSON = JSON.parse(data);
            }
            console.log(dataJSON);
            buildCheckboxes(dataJSON);
        };

        function buildCheckboxes(data) {
            var html = "";
            for (var item in data) {
                var status = (data[item].status) ? 'checked' : '';
                html += '<li>' + data[item].info + '<input type="checkbox" value="' + item + '" ' + status + '/></li>';
                $('#tasklist').html(html);
                addEvent(); //solution in video
            }
        }


        // Enhance Interaction

        //My solution -> jQuery version
        /*
        $('#tasklist :checkbox').on('change', function(e){
           dataJSON[$(this).val()].status = $(this).is(':checked');
           console.log(dataJSON);
        });
        */


        //Solution in video -> javascript version
        function addEvent() {
            var checkboxes = document.querySelectorAll('#tasklist input[type="checkbox"]');
            // var checkboxes = $('#tasklist :checkbox');
            for (var index in checkboxes) {
                checkboxes[index].onchange = updateJSON;
            }

        }

        function updateJSON() {
            var key = event.target.value;
            dataJSON[key].status = event.target.checked;
            console.log(dataJSON);
        }

        //Store data into session of the browser

    </script>
</body>

</html>
